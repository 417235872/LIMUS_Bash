# 基本逻辑

首先得确认设备的结构：

计算机	==网口==>	总板	==驱动==>	不同层的SP2E控制板 

然后还得确认设备的交付时间

## 通讯方式

#### 之前的通讯库是基于由Crypress公司的USB动态库在C#下写的，这次是用网口进行通讯，估计是底层会有一定的变化，估计之前的库又得重写了。

- 通讯方式(与USB通讯进行对比)
  - 确认设备上线：
    - 使用USB通讯时，通过检索计算机上的USB设备，寻找设备号（通过USB可以得到设备信息）与目标设备相同的设备文件(dev)，来确认设备上线。
    - 网口通讯说是使用IP协议，我有几个疑惑的地方：
      1. 要使用IP协议得获取一个IP地址，网口通讯的板子是有一个网络通讯的芯片来控制吗？
      2. 如何获取设备的IP地址？设备的IP标识是否能够调整？
  - 设备通讯协议：这个基本没有问题，之后测试一下看看能不能连上就好

## 控制流

#### 控制流主要是向接口发送一段二进制码，设备接收二进制码（命令码）对命令进行响应，从而实现计算机对设备进行操作。

#### 所以主要是要有各个命令的命令码

- 配置设备状态
  - 协商确认可以配置的参数（之前协商是高压和增益）
  - 配置设备的命令码结构（之前的命令码结构应该会有改动，因为现在是网口板接收信号驱动多块SP2E芯片板，至少应该有个寻址的操作啥的确定操作的）
- 操作设备
  - 主要是请求数据包命令

## 数据流

数据流主要是获取数据包的

- 获取数据包
  - 获取数据的解码协议（之前的协议已经能解包，主要看协议是否相同）
  - 如何分辨不同控制板（SP2E板）的数据？（猜测不同的地方可能对数据包会有一个地址标识来确认是哪个板子的数据）

- 获取当前设备状态
  - 这是新加的功能，之前商议过时定时发送一个包含设备状态的数据(就是每隔一段时间会向上发送一次)，**需要确认是否确认是使用这种模式**
  - 实验室需要获取的设备状态信息清单（之前是高压、增益，需要和沈老师还有旭佳师兄确认具体清单）
  - 如何与数据包进行分辨
  - 定时时间（即间隔多长时间发送）
  - 解包协议（估计还没写好）

